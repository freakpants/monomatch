<!DOCTYPE html>
<html>

<head>
    <script src="../phaser/dist/phaser.js"></script>
    <script type="text/javascript" src="https://www.airconsole.com/api/airconsole-1.7.0.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

    <style>
        html,
        body {
            height: 100%;
            margin: 0;
        }
    </style>
</head>

<body onload="init()">
    <script>
        var DEBUG = true;
        function init() {
            air_console = new AirConsole();

            // Listen for messages from other devices
            air_console.onMessage = function (from, message) {
                // handle message
                var type = message[0].type;
                DEBUG && console.log('handling ' + type + ' message on screen.');

                switch (type) {
                    case "confirm":
                        // assign a card from the stack to every client
                        var deviceIds = air_console.getControllerDeviceIds();
                        deviceIds.forEach(device_id => {
                            set_message = [];
                            set_message.push({ type: "set", set_id: document.stack[0], screen_set_id: document.set_id });
                            DEBUG && console.log("sending set info to device " + device_id);
                            air_console.message(device_id, set_message);
                            document.stack.shift();
                        });


                        break;
                }
            };

        }

    </script>
    <script type="module">
        import Guessing from '/game/scenes/Guessing.js';
        import { objects, projective_sets } from '/game/objects.js';

        $(document).ready(function () {


            // build the stack of cards
            document.stack = [];
            while (document.stack.length < 57) {
                var r = Math.floor(Math.random() * 57);
                if (document.stack.indexOf(r) === -1) document.stack.push(r);
            }
            DEBUG && console.log(document.stack);


            // get the first card from the stack
            document.set_id = document.stack[0];
            document.stack.shift();

            document.set = projective_sets.filter(obj => {
                return obj.id === document.set_id
            });

            DEBUG && console.log(document.stack);

            var config = {
                type: Phaser.AUTO,
                scale: {
                    mode: Phaser.Scale.NONE,
                    parent: 'body',
                    autoCenter: Phaser.Scale.NO_CENTER,
                    width: "100%",
                    height: "100%"
                },
                physics: {
                    default: 'arcade',
                    arcade: {
                        gravity: { y: 200 }
                    }
                },
                scene: [Guessing]
            };

            var game = new Phaser.Game(config);



        });

        var air_console;

    </script>

</body>

</html>