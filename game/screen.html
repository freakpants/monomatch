<!DOCTYPE html>
<html>

<head>


    <script type="text/javascript" src="https://www.airconsole.com/api/airconsole-1.7.0.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>$
    <script src="../phaser/dist/phaser.js"></script>
    <style>
        html,
        body {
            height: 100%;
            margin: 0;
        }
    </style>

    <script type="text/javascript">
        var url = "objects.js";

        function init() {
            air_console = new AirConsole();
        }

        class AlignGrid {
            constructor(config) {
                if (!config.scene) {
                    console.log("missing scene!");
                    return;
                }
                if (!config.rows) {
                    config.rows = 3;
                }
                if (!config.cols) {
                    config.cols = 3;
                }
                if (!config.width) {
                    config.width = document.body.offsetWidth;
                }
                if (!config.height) {
                    config.height = document.body.offsetHeight;
                }
                this.h = config.height;
                this.w = config.width;
                this.rows = config.rows;
                this.cols = config.cols;
                this.scene = config.scene;
                this.graphics = config.graphics;
                //cw cell width is the scene width divided by the number of columns
                this.cw = this.w / this.cols;
                //ch cell height is the scene height divided the number of rows
                this.ch = this.h / this.rows;
            }
            //mostly for planning and debugging this will
            //create a visual representation of the grid
            showNumbers(a = 1) {



                this.graphics.lineStyle(4, 0xff0000, a);

                this.graphics.beginPath();
                for (var i = 0; i < this.w; i += this.cw) {
                    this.graphics.moveTo(i, 0);
                    this.graphics.lineTo(i, this.h);
                }
                for (var i = 0; i < this.h; i += this.ch) {
                    this.graphics.moveTo(0, i);
                    this.graphics.lineTo(this.w, i);
                }

                this.graphics.strokePath();
            }

            //place an object in relation to the grid
            placeAt(xx, yy, obj) {
                //calculate the center of the cell
                //by adding half of the height and width
                //to the x and y of the coordinates
                var x2 = this.cw * xx + this.cw / 2;
                var y2 = this.ch * yy + this.ch / 2;
                obj.x = x2;
                obj.y = y2;
            }
        }

        var config = {
            type: Phaser.AUTO,
            scale: {
                mode: Phaser.Scale.NONE,
                parent: 'body',
                autoCenter: Phaser.Scale.NO_CENTER,
                width: "100%",
                height: "100%"
            },
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 200 }
                }
            },
            scene: {
                preload: preload,
                create: create
            }
        };



        function preload() {
            objects.forEach((object) => {
                this.load.image("asset" + object.id, "../game/assets/asset" + object.id + ".png");
            });

        }

        function create() {
            window.addEventListener('resize', resize);
            resize();



            var graphics = this.add.graphics();

            graphics.fillGradientStyle(0x0000ff, 0x0000ff, 0xaaffff, 0xaaffff);
            graphics.fillRect(0, 0, document.body.offsetWidth, document.body.offsetHeight);

            var gridConfig = {
                'scene': this,
                'cols': 4,
                'rows': 3,
                'graphics': graphics
            }
            this.aGrid = new AlignGrid(gridConfig);
            // this.aGrid.showNumbers();

            this.assets = [];




            console.log(arr);

            i = 0;
            for (col = 0; col < 4; col++) {
                for (row = 0; row < 3; row++) {
                    this.assets[i] = this.add.image(0, 0, "asset" + arr[i]);
                    this.aGrid.placeAt(col, row, this.assets[i]);
                    this.assets[i].displayWidth = (document.body.offsetWidth / 4) * 0.6;
                    this.assets[i].scaleY = this.assets[i].scaleX;
                    i++;
                }
            }

        }

        function resize() {
            var canvas = game.canvas;
            canvas.style.width = document.body.offsetWidth + 'px';
            canvas.style.height = document.body.offsetHeight + 'px';
        }

        $.getScript(url, function () {
            $(document).ready(function () {
                // determine 12 objects to display on the screen
                var arr = [];
                while (arr.length < 12) {
                    var r = Math.floor(Math.random() * 26);
                    if (arr.indexOf(r) === -1) arr.push(r);
                }

                var air_console;
                var game = new Phaser.Game(config);
            });
        });




        
    </script>

</head>

<body onload="init()">
</body>

</html>